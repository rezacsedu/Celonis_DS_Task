import pandas as pd
import numpy as np
from pycaret.regression import load_model, predict_model
from fastapi import FastAPI
import uvicorn

X_test = np.load('X_train.npy')
y_test = np.load('y_train.npy')
df = pd.DataFrame(X_test)
df.columns = ['X_' + str(col) for col in df.columns]
y_test = pd.DataFrame(y_test, columns=['gesture'])
X_test = pd.concat([df, y_test], ignore_index=False, axis=1).reset_index(drop=True)
cols = df.columns

# 2. Create the app object
app = FastAPI()

#. Load trained Pipeline
model = load_model('gesture_recognition_pipeline')    
    
# Define predict function
@app.post('/prediction')
def predict(X_0, X_1, X_2, X_3, X_4, X_5, X_6, X_7, X_8, X_9, X_10, X_11, X_12, X_13, X_14, X_15, X_16, X_17, X_18, X_19, X_20, X_21, X_22, X_23, X_24, X_25, X_26, X_27, X_28, X_29, X_30, X_31, X_32, X_33, X_34, X_35, X_36, X_37, X_38, X_39, X_40, X_41, X_42, X_43, X_44, X_45, X_46, X_47, X_48, X_49, X_50, X_51, X_52, X_53, X_54, X_55, X_56, X_57, X_58, X_59, X_60, X_61, X_62, X_63, X_64, X_65, X_66, X_67, X_68, X_69, X_70, X_71, X_72, X_73, X_74, X_75, X_76, X_77, X_78, X_79, X_80, X_81, X_82, X_83, X_84, X_85, X_86, X_87, X_88, X_89, X_90, X_91, X_92, X_93, X_94, X_95, X_96, X_97, X_98, X_99, X_100, X_101, X_102, X_103, X_104, X_105, X_106, X_107, X_108, X_109, X_110, X_111, X_112, X_113, X_114, X_115, X_116, X_117, X_118, X_119, X_120, X_121, X_122, X_123, X_124, X_125, X_126, X_127, X_128, X_129, X_130, X_131, X_132, X_133, X_134, X_135, X_136, X_137, X_138, X_139, X_140, X_141, X_142, X_143, X_144, X_145, X_146, X_147, X_148, X_149, X_150, X_151, X_152, X_153, X_154, X_155, X_156, X_157, X_158, X_159, X_160, X_161, X_162, X_163, X_164, X_165, X_166, X_167, X_168, X_169, X_170, X_171, X_172, X_173, X_174, X_175, X_176, X_177, X_178, X_179, X_180, X_181, X_182, X_183, X_184, X_185, X_186, X_187, X_188, X_189, X_190, X_191, X_192, X_193, X_194, X_195, X_196, X_197, X_198, X_199, X_200, X_201, X_202, X_203, X_204, X_205, X_206, X_207, X_208, X_209, X_210, X_211, X_212, X_213, X_214, X_215, X_216, X_217, X_218, X_219, X_220, X_221, X_222, X_223, X_224, X_225, X_226, X_227, X_228, X_229, X_230, X_231, X_232, X_233, X_234, X_235, X_236, X_237, X_238, X_239, X_240, X_241, X_242, X_243, X_244, X_245, X_246, X_247, X_248, X_249, X_250, X_251, X_252, X_253, X_254, X_255, X_256, X_257, X_258, X_259, X_260, X_261, X_262, X_263, X_264, X_265, X_266, X_267, X_268, X_269, X_270, X_271, X_272, X_273, X_274, X_275, X_276, X_277, X_278, X_279, X_280, X_281, X_282, X_283, X_284, X_285, X_286, X_287, X_288, X_289, X_290, X_291, X_292, X_293, X_294, X_295, X_296, X_297, X_298, X_299, X_300, X_301, X_302, X_303, X_304, X_305, X_306, X_307, X_308, X_309, X_310, X_311, X_312, X_313, X_314, X_315, X_316, X_317, X_318, X_319, X_320, X_321, X_322, X_323, X_324, X_325, X_326, X_327, X_328, X_329, X_330, X_331, X_332, X_333, X_334, X_335, X_336, X_337, X_338, X_339, X_340, X_341, X_342, X_343, X_344, X_345, X_346, X_347, X_348, X_349, X_350, X_351, X_352, X_353, X_354, X_355, X_356, X_357, X_358, X_359, X_360, X_361, X_362, X_363, X_364, X_365, X_366, X_367, X_368, X_369, X_370, X_371, X_372, X_373, X_374, X_375, X_376, X_377, X_378, X_379, X_380, X_381, X_382, X_383, X_384, X_385, X_386, X_387, X_388, X_389, X_390, X_391, X_392, X_393, X_394, X_395, X_396, X_397, X_398, X_399, X_400, X_401, X_402, X_403, X_404, X_405, X_406, X_407, X_408, X_409, X_410, X_411, X_412, X_413, X_414, X_415, X_416, X_417, X_418, X_419, X_420, X_421, X_422, X_423, X_424, X_425, X_426, X_427, X_428, X_429, X_430, X_431, X_432, X_433, X_434, X_435, X_436, X_437, X_438, X_439, X_440, X_441, X_442, X_443, X_444, X_445, X_446, X_447, X_448, X_449, X_450, X_451, X_452, X_453, X_454, X_455, X_456, X_457, X_458, X_459, X_460, X_461, X_462, X_463, X_464, X_465, X_466, X_467, X_468, X_469, X_470, X_471, X_472, X_473, X_474, X_475, X_476, X_477, X_478, X_479, X_480, X_481, X_482, X_483, X_484, X_485, X_486, X_487, X_488, X_489, X_490, X_491, X_492, X_493, X_494, X_495, X_496, X_497, X_498, X_499, X_500, X_501, X_502, X_503, X_504, X_505, X_506, X_507, X_508, X_509, X_510, X_511, X_512, X_513, X_514, X_515, X_516, X_517, X_518, X_519, X_520, X_521, X_522, X_523, X_524, X_525, X_526, X_527, X_528, X_529, X_530, X_531, X_532, X_533, X_534, X_535, X_536, X_537, X_538, X_539, X_540, X_541, X_542, X_543, X_544, X_545, X_546, X_547, X_548, X_549, X_550, X_551, X_552, X_553, X_554, X_555, X_556, X_557, X_558, X_559, X_560, X_561, X_562, X_563, X_564, X_565, X_566, X_567, X_568, X_569, X_570, X_571, X_572, X_573, X_574, X_575, X_576, X_577, X_578, X_579, X_580, X_581, X_582, X_583, X_584, X_585, X_586, X_587, X_588, X_589, X_590, X_591, X_592, X_593, X_594, X_595, X_596, X_597, X_598, X_599, X_600, X_601, X_602, X_603, X_604, X_605, X_606, X_607, X_608, X_609, X_610, X_611, X_612, X_613, X_614, X_615, X_616, X_617, X_618, X_619, X_620, X_621, X_622, X_623, X_624, X_625, X_626, X_627, X_628, X_629, X_630, X_631, X_632, X_633, X_634, X_635, X_636, X_637, X_638, X_639, X_640, X_641, X_642, X_643, X_644, X_645, X_646, X_647, X_648, X_649, X_650, X_651, X_652, X_653, X_654, X_655, X_656, X_657, X_658, X_659, X_660, X_661, X_662, X_663, X_664, X_665, X_666, X_667, X_668, X_669, X_670, X_671, X_672, X_673, X_674, X_675, X_676, X_677, X_678, X_679, X_680, X_681, X_682, X_683, X_684, X_685, X_686, X_687, X_688, X_689, X_690, X_691, X_692, X_693, X_694, X_695, X_696, X_697, X_698, X_699, X_700, X_701, X_702, X_703, X_704, X_705, X_706, X_707, X_708, X_709, X_710, X_711, X_712, X_713, X_714, X_715, X_716, X_717, X_718, X_719, X_720, X_721, X_722, X_723, X_724, X_725, X_726, X_727, X_728, X_729, X_730, X_731, X_732, X_733, X_734, X_735, X_736, X_737, X_738, X_739, X_740, X_741, X_742, X_743, X_744, X_745, X_746, X_747, X_748, X_749, X_750, X_751, X_752, X_753, X_754, X_755, X_756, X_757, X_758, X_759, X_760, X_761, X_762, X_763, X_764, X_765, X_766, X_767, X_768, X_769, X_770, X_771, X_772, X_773, X_774, X_775, X_776, X_777, X_778, X_779, X_780, X_781, X_782, X_783, X_784, X_785, X_786, X_787, X_788, X_789, X_790, X_791, X_792, X_793, X_794, X_795, X_796, X_797, X_798, X_799, X_800, X_801, X_802, X_803, X_804, X_805, X_806, X_807, X_808, X_809, X_810, X_811, X_812, X_813, X_814, X_815, X_816, X_817, X_818, X_819, X_820, X_821, X_822, X_823, X_824, X_825, X_826, X_827, X_828, X_829, X_830, X_831, X_832, X_833, X_834, X_835, X_836, X_837, X_838, X_839, X_840, X_841, X_842, X_843, X_844, X_845, X_846, X_847, X_848, X_849, X_850, X_851, X_852, X_853, X_854, X_855, X_856, X_857, X_858, X_859, X_860, X_861, X_862, X_863, X_864, X_865, X_866, X_867, X_868, X_869, X_870, X_871, X_872, X_873, X_874, X_875, X_876, X_877, X_878, X_879, X_880, X_881, X_882, X_883, X_884, X_885, X_886, X_887, X_888, X_889, X_890, X_891, X_892, X_893, X_894, X_895, X_896, X_897, X_898, X_899, X_900, X_901, X_902, X_903, X_904, X_905, X_906, X_907, X_908, X_909, X_910, X_911, X_912, X_913, X_914, X_915, X_916, X_917, X_918, X_919, X_920, X_921, X_922, X_923, X_924, X_925, X_926, X_927, X_928, X_929, X_930, X_931, X_932, X_933, X_934, X_935, X_936, X_937, X_938, X_939, X_940, X_941, X_942, X_943, X_944):
    data = pd.DataFrame([cols])
    data.columns = cols

    predictions = predict_model(model, data=data) 
    return {'prediction': int(predictions['gesture'][0])}

if __name__ == '__main__':
    uvicorn.run(app, host='127.0.0.1', port=8000)